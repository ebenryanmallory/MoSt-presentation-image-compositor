<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="css/style.css"> 
    </head>
    <body>
        <section>
            <div class="ex1">
                <div id="image-holder" class="parent">
                    <h2>Create a Presentation Composite Image</h2>
                    <p>Screenshot two images of a web page, and display them side-by-side.</p>
                    <img id="result-image" src="temp/result.png" />
                </div>
                <br><br><hr>
                <div class="relative container" style="max-width: 50rem;">
                    <div class="parent absolute color-container">
                        <input class="hidden" id="left" type="file" onchange="checkFileUpload()" />
                        <label class="left" for="left">Choose left image:</label>
                        <input class="hidden" id="right" type="file" onchange="checkFileUpload()" />
                        <label class="right" for="right">Choose right image:</label>
                        <p class="hidden" id="feedback"></p>
                    </div>
                    <br><br><br><hr>
                    <div class="parent absolute color-container">
                        <label for="url">Snapshot from URL:</label>
                        <input id="url" type="url" placeholder="Example: www.motionstoryline.com" />
                    </div>
                </div>
                <br><br><hr>
                <div class="parent absolute color-container">
                    <div class="color" style="background:plum" onclick="selectColor(this)" data-color="plum"></div>
                    <div class="color" style="background:rebeccapurple" onclick="selectColor(this)" data-color="rebeccapurple"></div>
                    <div class="color" style="background:sienna" onclick="selectColor(this)" data-color="sienna"></div>
                    <div class="color" style="background:#2a3c44" onclick="selectColor(this)" data-color="#2a3c44"></div>
                </div>
            </div>
        </section>

        <br><br><br><br><hr><br>

        <section class="ex1">
            <div class="container parent">
                <h4>Inspiration</h4>
                <img style="max-width:500px;" src="images/page.jpg" />
                <div class="attribution">
                    <p>Inspiration was taken from the brilliant
                        <a href="https://dribbble.com/mikekus" target="_blank">Mike Kus</a>
                    </p>
                </div>
            </div>
        </section>

        <script>

        const settings = {};
        settings['color'] = '#2a3c44';

        async function post() {
            const url = '/composite-image'
            const response = await fetch(url, {
                method: 'POST',
                mode: 'same-origin',
                headers: {
                    'Content-Type': 'application/json'
                    },
                body: JSON.stringify(settings)
            });
            return response.blob();
        }

        async function getImage() {
            let returnedImage = await post();
            let returnedImageBlob = await returnedImage;
            const returnedImageURL = URL.createObjectURL(returnedImageBlob)
            document.querySelector('img#result-image').remove();
            let updateImage = document.createElement('img');
            updateImage.src = "temp/result.png";
            updateImage.src = returnedImageURL;
            updateImage.id = "result-image";
            document.querySelector('div#image-holder').appendChild(updateImage)
        }

        function selectColor(color) {
            document.querySelectorAll('.border').forEach(border => border.classList.remove('border'));
            color.classList.add('border');
            let selectedColor = color.getAttribute('data-color');
            settings['color'] = selectedColor;
            gatherSettings();
            getImage();
        }
        function gatherSettings() {
            let snapshotURL = document.querySelector('input#url').value;
            settings['url'] = snapshotURL;
            settings['windowLocation'] = window.location.href;
        }
        function checkFileUpload() {
            var leftFileInput = document.querySelector('input#left');
            var rightFileInput = document.querySelector('input#right');
            var feedback = ``;
            if ('files' in leftFileInput) {
                if (leftFileInput.files.length == 0 && rightFileInput.files.length == 0) { return feedback = "Select one or more files." };
                if (leftFileInput.files.length > 0) {
                    var leftFile = leftFileInput.files[0];
                    if (leftFile.name) {
                        feedback = feedback.concat(`File name: ${leftFile.name} | `);
                    }
                    if (leftFile.size) {
                        feedback = feedback.concat(`File size: ${leftFile.size} | `);
                    }
                }
            }
            if ('files' in rightFileInput) {
                if (leftFileInput.files.length == 0 && rightFileInput.files.length == 0) { return feedback = "Select one or more files." };
                if (rightFileInput.files.length > 0) {
                    var rightFile = rightFileInput.files[0];
                    if (rightFile.name) {
                        feedback = feedback.concat(`File name: ${rightFile.name} | `);
                    }
                    if (rightFile.size) {
                        feedback = feedback.concat(`File size: ${rightFile.size} | `);
                    }
                }
            }
            document.querySelector('p#feedback').classList.remove('hidden');
            document.querySelector('p#feedback').innerText = feedback;
            }
        </script>
    </body>
</html>